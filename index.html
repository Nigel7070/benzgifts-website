<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benzgifts - Premium Custom T-Shirts & Apparel</title>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: #fff;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #555;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .auth-btn {
            padding: 0.5rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .auth-btn:hover {
            background: #5568d3;
        }

        .user-menu {
            position: relative;
        }

        .user-email {
            cursor: pointer;
            color: #667eea;
            font-weight: 500;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-radius: 5px;
            margin-top: 0.5rem;
            min-width: 200px;
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-item {
            padding: 0.8rem 1rem;
            cursor: pointer;
            transition: background 0.3s;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .page-container {
            display: none;
        }

        .page-container.active {
            display: block;
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5rem 2rem;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: fadeInUp 1s ease;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.2s backwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .features {
            padding: 4rem 2rem;
            background: #f8f9fa;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .section-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 3rem;
        }

        .products {
            padding: 4rem 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .product-specs {
            list-style: none;
            color: #666;
            font-size: 0.9rem;
        }

        .product-specs li {
            padding: 0.3rem 0;
            padding-left: 1.2rem;
            position: relative;
        }

        .product-specs li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .order-btn, .add-cart-btn {
            flex: 1;
            padding: 0.8rem;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .order-btn {
            background: #667eea;
        }

        .order-btn:hover {
            background: #5568d3;
            transform: scale(1.02);
        }

        .add-cart-btn {
            background: #28a745;
        }

        .add-cart-btn:hover {
            background: #218838;
            transform: scale(1.02);
        }

        .about {
            padding: 4rem 2rem;
            background: #f8f9fa;
        }

        .about-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .about-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            color: #555;
            line-height: 1.8;
        }

        .faq {
            padding: 4rem 2rem;
        }

        .faq-item {
            background: white;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .faq-question {
            padding: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .faq-question:hover {
            background: #f8f9fa;
        }

        .faq-question::after {
            content: '+';
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .faq-question.active::after {
            transform: rotate(45deg);
        }

        .faq-answer {
            padding: 0 1.5rem;
            color: #666;
            line-height: 1.8;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s, padding 0.3s;
        }

        .faq-answer.active {
            padding: 0 1.5rem 1.5rem;
            max-height: 500px;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .cta-button {
            display: inline-block;
            padding: 1rem 2rem;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .cta-button:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #5568d3;
            transform: scale(1.02);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .success-message, .error-message, .info-message {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message {
            background: #4caf50;
            color: white;
        }

        .error-message {
            background: #f44336;
            color: white;
        }

        .info-message {
            background: #2196F3;
            color: white;
        }

        .contact-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }

        .contact-info h2 {
            margin-bottom: 1rem;
        }

        .contact-methods {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .contact-method {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 10px;
            min-width: 200px;
        }

        .contact-method h3 {
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .cart-float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 999;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-float-btn:hover {
            transform: scale(1.1);
            background: #5568d3;
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .cart-items {
            max-height: 400px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            gap: 1rem;
        }

        .cart-item-select {
            margin-right: 0.5rem;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.3rem;
        }

        .cart-item-price {
            color: #667eea;
            font-weight: bold;
        }

        .cart-item-remove {
            background: #ff4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .cart-item-remove:hover {
            background: #cc0000;
        }

        .cart-total {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            text-align: right;
        }

        .cart-total-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .cart-total-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .cart-actions {
            display: flex;
            gap: 1rem;
        }

        .clear-cart-btn {
            flex: 1;
            padding: 0.8rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .clear-cart-btn:hover {
            background: #c82333;
        }

        .checkout-btn {
            flex: 1;
            padding: 0.8rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .checkout-btn:hover {
            background: #218838;
        }

        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
            color: #999;
        }

        .profile-container, .checkout-container {
            max-width: 1200px;
            margin: 4rem auto;
            padding: 2rem;
        }

        .profile-header, .checkout-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .profile-header h1, .checkout-header h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .profile-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: grid;
            gap: 1.5rem;
        }

        .checkout-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .checkout-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .checkout-section h2 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .order-item-details {
            color: #666;
            font-size: 0.9rem;
        }

        .order-item-price {
            font-weight: bold;
            color: #667eea;
        }

        .order-summary {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #f0f0f0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .summary-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #667eea;
        }

        @media (max-width: 968px) {
            .checkout-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .contact-methods {
                flex-direction: column;
                align-items: center;
            }

            .cart-float-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .product-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo" onclick="showPage('home')">Benzgifts</div>
            <ul class="nav-links">
                <li><a onclick="showPage('home')">Home</a></li>
                <li><a onclick="scrollToSection('shop')">Shop</a></li>
                <li><a onclick="scrollToSection('about')">About</a></li>
                <li><a onclick="scrollToSection('faq')">FAQ</a></li>
                <li><a onclick="scrollToSection('contact')">Contact</a></li>
                <li id="adminNavLink" style="display: none;">
                    <a onclick="goToAdminPanel()" style="color: #667eea; font-weight: 600;">⚙️ Admin</a>
                </li>
                <li id="authSection">
                    <button class="auth-btn" onclick="openAuthModal()">Login / Sign Up</button>
                </li>
            </ul>
        </nav>
    </header>

    <button class="cart-float-btn" onclick="openCart()">
        🛒
        <span class="cart-badge" id="cartBadge">0</span>
    </button>

    <!-- HOME PAGE -->
    <div id="homePage" class="page-container active">
        <section class="hero" id="home">
            <div class="container">
                <h1>Stand Out From The Crowd With Custom T-shirts</h1>
                <p>Premium Quality Apparel for Your Brand</p>
                <a onclick="scrollToSection('shop')" class="cta-button">Explore Products</a>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">📦</div>
                        <h3>No Minimum Quantity</h3>
                        <p>Order as few or as many as you need</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">✨</div>
                        <h3>Premium Workmanship</h3>
                        <p>Superior quality in every stitch</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🧵</div>
                        <h3>Variety of Heavyweight Fabric</h3>
                        <p>Choose from multiple premium fabrics</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">✂️</div>
                        <h3>Variety of Oversized Cutting</h3>
                        <p>Modern fits for contemporary style</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🎨</div>
                        <h3>Premium Printing Solutions</h3>
                        <p>DTG, DTF, and silkscreen options</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="products" id="shop">
            <div class="container">
                <h2 class="section-title">Our Products</h2>
                <p class="section-subtitle">Loading products...</p>
                <div style="text-align: center; margin-bottom: 1rem;">
                    <button onclick="window.refreshProducts()" style="padding: 0.8rem 2rem; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
                        🔄 Refresh Products
                    </button>
                </div>
                
                <div class="products-grid">
                    <!-- Products will be loaded dynamically from database -->
                </div>
            </div>
        </section>

        <section class="about" id="about">
            <div class="container">
                <h2 class="section-title">Benzgifts: Redefining Premium T-Shirts</h2>
                <div class="about-content">
                    <p>Benzgifts was founded with a clear mission: to offer premium quality T-shirts at accessible price points, specifically tailored for emerging clothing brands. From the outset, we differentiated ourselves through our commitment to high-quality materials, launching with an exclusive range of fabrics including Lycra Spandex and 40FC Interlock. These products quickly gained widespread acclaim for their superior feel and durability.</p>
                    
                    <p>In 2023, Benzgifts expanded its capabilities by introducing state-of-the-art DTG printing services and broadening our product line. This new collection featured 100% cotton T-shirts in 230gsm, 250gsm, and 305gsm weights, alongside our distinctive stone-washed fabrics.</p>
                    
                    <p>Through continuous innovation and a customer-centric approach, Benzgifts has become a trusted leader in the market, renowned for delivering high-quality apparel that meets the demands of today's clothing entrepreneurs.</p>
                </div>
            </div>
        </section>

        <section class="faq" id="faq">
            <div class="container">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <p class="section-subtitle">Got a question? We're here to answer!</p>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        How do I place a custom order?
                    </div>
                    <div class="faq-answer">
                        Choose from premium fabrics like 100% cotton (230gsm, 250gsm, 305gsm), 40FC Interlock, and stone-washed options. Select from DTG (Direct-to-Garment), Silkscreen, DTF (Direct-to-Film), or embroidery for your designs. Submit your own designs and mockups to us. Ensure all files are in high resolution. Choose from a range of size options. We accommodate both small and large orders. Each product undergoes strict quality checks to maintain top standards.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        What file formats do you accept?
                    </div>
                    <div class="faq-answer">
                        We accept files in PNG, PDF, AI, PSD, and more. Please ensure the files are high resolution, have a transparent background, and are at least 300DPI.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        What is the delivery timeframe?
                    </div>
                    <div class="faq-answer">
                        We aim to deliver products within 2 weeks. For orders of more than 500 pieces, please contact our customer support for an exact lead time.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        How can I contact customer support?
                    </div>
                    <div class="faq-answer">
                        You can reach out to our customer support for any inquiries, and we will aim to respond promptly via WhatsApp or email.
                    </div>
                </div>
            </div>
        </section>

        <section class="contact-info" id="contact">
            <div class="container">
                <h2>Get In Touch</h2>
                <p>Contact us for custom orders and inquiries</p>
                <div class="contact-methods">
                    <div class="contact-method">
                        <h3>📧 Email</h3>
                        <p>stella.benzgifts@gmail.com</p>
                    </div>
                    <div class="contact-method">
                        <h3>📱 WhatsApp</h3>
                        <p>016-800 0175</p>
                    </div>
                    <div class="contact-method">
                        <h3>📍 Location</h3>
                        <p>Sibu, Sarawak</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- PROFILE PAGE -->
    <div id="profilePage" class="page-container">
        <div class="profile-container">
            <div class="profile-header">
                <h1>My Profile</h1>
                <p style="color: #666;">Manage your personal information</p>
            </div>

            <div class="success-message" id="profileSuccess"></div>
            <div class="error-message" id="profileError"></div>

            <form id="profileForm" class="profile-form" onsubmit="saveProfile(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="profileEmail" disabled>
                </div>

                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="profileName" required>
                </div>

                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="profilePhone" required>
                </div>

                <div class="form-group">
                    <label>Address *</label>
                    <textarea id="profileAddress" required></textarea>
                </div>

                <div class="form-group">
                    <label>City *</label>
                    <input type="text" id="profileCity" required>
                </div>

                <div class="form-group">
                    <label>Postal Code *</label>
                    <input type="text" id="profilePostalCode" required>
                </div>

                <div class="form-group">
                    <label>State *</label>
                    <input type="text" id="profileState" required>
                </div>

                <button type="submit" class="submit-btn" id="profileSubmitBtn">Save Profile</button>
            </form>
        </div>
    </div>

    <!-- CHECKOUT PAGE -->
    <div id="checkoutPage" class="page-container">
        <div class="checkout-container">
            <div class="checkout-header">
                <h1>Checkout</h1>
                <p style="color: #666;">Complete your order</p>
            </div>

            <div class="success-message" id="checkoutSuccess"></div>
            <div class="error-message" id="checkoutError"></div>

            <div class="checkout-grid">
                <!-- Order Summary -->
                <div class="checkout-section">
                    <h2>Order Summary</h2>
                    <div id="checkoutItems"></div>
                    <div class="order-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="checkoutSubtotal">RM0.00</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total:</span>
                            <span id="checkoutTotalAmount">RM0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Shipping Form -->
                <div class="checkout-section">
                    <h2>Shipping Information</h2>
                    <form id="checkoutForm" onsubmit="submitCheckout(event)">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="checkoutName" required>
                        </div>

                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="checkoutEmail" required>
                        </div>

                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="checkoutPhone" required>
                        </div>

                        <div class="form-group">
                            <label>Address *</label>
                            <textarea id="checkoutAddress" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>City *</label>
                            <input type="text" id="checkoutCity" required>
                        </div>

                        <div class="form-group">
                            <label>Postal Code *</label>
                            <input type="text" id="checkoutPostalCode" required>
                        </div>

                        <div class="form-group">
                            <label>State *</label>
                            <input type="text" id="checkoutState" required>
                        </div>

                        <div class="form-group">
                            <label>Additional Notes</label>
                            <textarea id="checkoutNotes" placeholder="Any special instructions for delivery (optional)"></textarea>
                        </div>

                        <button type="submit" class="submit-btn" id="checkoutSubmitBtn">Place Order</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h2>Welcome to Benzgifts</h2>
            
            <div class="success-message" id="authSuccess"></div>
            <div class="error-message" id="authError"></div>
            <div class="info-message" id="authInfo"></div>

            <form id="authForm" onsubmit="handleAuth(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="authEmail" placeholder="Enter your email" required>
                </div>

                <button type="submit" class="submit-btn" id="authSubmitBtn">Send Magic Link</button>
                
                <p style="text-align: center; margin-top: 1rem; color: #666; font-size: 0.9rem;">
                    We'll send you a magic link to sign in or create your account
                </p>
            </form>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCart()">&times;</span>
            <h2>Shopping Cart</h2>
            
            <div id="cartItems" class="cart-items">
                <div class="empty-cart">Your cart is empty</div>
            </div>

            <div class="cart-total" id="cartTotalSection" style="display: none;">
                <span class="cart-total-label">Total (Selected): </span>
                <span class="cart-total-amount" id="cartTotal">RM0.00</span>
            </div>

            <div class="cart-actions" id="cartActions" style="display: none;">
                <button class="clear-cart-btn" onclick="clearCart()">Clear Cart</button>
                <button class="checkout-btn" onclick="proceedToCheckout()" id="checkoutBtn">Checkout</button>
            </div>
        </div>
    </div>

    <!-- Order Form Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOrderForm()">&times;</span>
            <h2>Place Your Order</h2>
            
            <div class="success-message" id="orderSuccess">
                Order details captured! We'll contact you soon.
            </div>

            <form id="orderForm" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label>Product</label>
                    <input type="text" id="product" readonly>
                </div>

                <div class="form-group">
                    <label>Price</label>
                    <input type="text" id="price" readonly>
                </div>

                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="orderName" required>
                </div>

                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="orderEmail" required>
                </div>

                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="orderPhone" required>
                </div>

                <div class="form-group">
                    <label>Address *</label>
                    <textarea id="orderAddress" required></textarea>
                </div>

                <div class="form-group">
                    <label>City *</label>
                    <input type="text" id="orderCity" required>
                </div>

                <div class="form-group">
                    <label>Postal Code *</label>
                    <input type="text" id="orderPostalCode" required>
                </div>

                <div class="form-group">
                    <label>State *</label>
                    <input type="text" id="orderState" required>
                </div>

                <div class="form-group">
                    <label>Quantity *</label>
                    <input type="number" id="orderQuantity" min="1" required>
                </div>

                <div class="form-group">
                    <label>Size *</label>
                    <select id="orderSize" required>
                        <option value="">Select Size</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                        <option value="3XL">3XL</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Custom Design Requirements</label>
                    <textarea id="orderCustomDesign" placeholder="Describe your custom design requirements (optional)"></textarea>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="orderNotes" placeholder="Any other information we should know (optional)"></textarea>
                </div>

                <button type="submit" class="submit-btn" id="orderSubmitBtn">Submit Order</button>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Benzgifts. All rights reserved.</p>
            <p>Premium Custom Apparel Solutions</p>
        </div>
    </footer>

    <script>
        // ============================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ============================================
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://oomvdejocpdtqcmeacii.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vbXZkZWpvY3BkdHFjbWVhY2lpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MzA1NjksImV4cCI6MjA3NTUwNjU2OX0.0P_dEqRlvSUVJiCF_F0mboSenqvbp64ZV9islyvcF_E';

        // Google Sheets Configuration
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzkdMCh4wtgoSLd4PwGg4Sr2cI4eUG-L-8PrweNGjTtSglGyzb-43aw68Tb-FbJabI1/exec';

        // Admin emails
        const ADMIN_EMAILS = ['stella.benzgifts@gmail.com', 'himynameisblink123@gmail.com'];

        // ============================================
        // INITIALIZATION
        // ============================================

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let cart = [];
        let selectedCartItems = new Set();
        let checkoutItems = [];
        let allProducts = []; // Store products from database

        // ============================================
        // GOOGLE SHEETS FUNCTIONS
        // ============================================

        async function sendToGoogleSheets(orderData) {
            if (GOOGLE_SHEETS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.warn('Google Sheets URL not configured. Skipping data submission.');
                return false;
            }

            try {
                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                console.log('Data sent to Google Sheets successfully');
                return true;
            } catch (error) {
                console.error('Error sending to Google Sheets:', error);
                return false;
            }
        }

        // ============================================
        // PRODUCTS LOADING - SIMPLIFIED VERSION
        // ============================================

        async function loadProducts() {
            console.log('Loading products...');
            const productsGrid = document.querySelector('.products-grid');
            const subtitle = document.querySelector('.section-subtitle');
            
            try {
                if (subtitle) subtitle.textContent = 'Loading products...';
                
                // Simple query - no timeout, no fancy stuff
                const result = await supabase
                    .from('products')
                    .select('*');
                
                console.log('Query result:', result);

                if (result.error) {
                    throw new Error(result.error.message);
                }

                allProducts = result.data || [];
                console.log(`Loaded ${allProducts.length} products`);
                
                displayProducts();
            } catch (error) {
                console.error('Error loading products:', error);
                
                if (subtitle) subtitle.textContent = 'Error loading products';
                if (productsGrid) {
                    productsGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #dc3545;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">⚠️</div>
                            <p><strong>Cannot load products</strong></p>
                            <p style="font-size: 0.9rem; color: #666; margin: 1rem;">${error?.message || 'Unknown error'}</p>
                            <button onclick="window.refreshProducts()" style="margin-top: 1rem; padding: 0.8rem 2rem; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                🔄 Try Again
                            </button>
                        </div>
                    `;
                }
            }
        }

        function displayProducts() {
            const productsGrid = document.querySelector('.products-grid');
            const subtitle = document.querySelector('.section-subtitle');
            
            try {
                if (allProducts.length === 0) {
                    subtitle.textContent = 'No products available';
                    productsGrid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #999;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">📦</div>
                            <p>No products available at the moment. Check back soon!</p>
                        </div>
                    `;
                    return;
                }

                subtitle.textContent = `Showing all ${allProducts.length} results`;

                productsGrid.innerHTML = allProducts.map(product => {
                    try {
                        // Safely get image URL
                        let imageDisplay = '👕';
                        if (product.images && Array.isArray(product.images) && product.images.length > 0) {
                            const imageUrl = product.images[0];
                            if (imageUrl && typeof imageUrl === 'string') {
                                imageDisplay = `<img src="${imageUrl}" style="width: 100%; height: 100%; object-fit: cover;" alt="${product.name || 'Product'}" onerror="this.parentElement.innerHTML='👕'">`;
                            }
                        }
                        
                        const stockStatus = product.stock_quantity > 0 ? 'In Stock' : 'Out of Stock';
                        const stockColor = product.stock_quantity > 0 ? '#28a745' : '#dc3545';
                        
                        // Safely display colors
                        let colorsHtml = '';
                        if (product.colors && Array.isArray(product.colors) && product.colors.length > 0) {
                            colorsHtml = `
                                <div style="margin-bottom: 0.5rem;">
                                    <strong style="font-size: 0.9rem;">Colors:</strong> 
                                    <span style="font-size: 0.9rem;">${product.colors.join(', ')}</span>
                                </div>
                            `;
                        }
                        
                        // Safely display sizes
                        let sizesHtml = '';
                        if (product.sizes && Array.isArray(product.sizes) && product.sizes.length > 0) {
                            sizesHtml = `
                                <div style="margin-bottom: 0.5rem;">
                                    <strong style="font-size: 0.9rem;">Sizes:</strong> 
                                    <span style="font-size: 0.9rem;">${product.sizes.join(', ')}</span>
                                </div>
                            `;
                        }
                        
                        // Safely display specifications
                        let specsHtml = '';
                        if (product.specifications && Array.isArray(product.specifications) && product.specifications.length > 0) {
                            specsHtml = product.specifications.map(spec => `<li>${spec || ''}</li>`).join('');
                        }
                        
                        return `
                            <div class="product-card">
                                <div class="product-image">${imageDisplay}</div>
                                <div class="product-info">
                                    <div class="product-price">RM${parseFloat(product.price || 0).toFixed(2)}</div>
                                    <div class="product-name">${product.name || 'Unnamed Product'}</div>
                                    <div style="margin-bottom: 0.5rem;">
                                        <span style="color: ${stockColor}; font-weight: 600; font-size: 0.9rem;">
                                            ${stockStatus} ${product.stock_quantity > 0 ? `(${product.stock_quantity} available)` : ''}
                                        </span>
                                    </div>
                                    ${colorsHtml}
                                    ${sizesHtml}
                                    ${specsHtml ? `<ul class="product-specs">${specsHtml}</ul>` : ''}
                                    <div class="product-actions">
                                        ${product.stock_quantity > 0 ? `
                                            <button class="add-cart-btn" onclick="addToCart('${(product.name || 'Product').replace(/'/g, "\\'")}', ${parseFloat(product.price || 0)}, '${product.id}')">Add to Cart</button>
                                            <button class="order-btn" onclick="openOrderForm('${(product.name || 'Product').replace(/'/g, "\\'")}', 'RM${parseFloat(product.price || 0).toFixed(2)}', '${product.id}')">Order Now</button>
                                        ` : `
                                            <button class="order-btn" disabled style="background: #ccc; cursor: not-allowed;">Out of Stock</button>
                                        `}
                                    </div>
                                </div>
                            </div>
                        `;
                    } catch (productError) {
                        console.error('Error rendering product:', product, productError);
                        return ''; // Skip this product if there's an error
                    }
                }).join('');

                console.log('Products displayed successfully');
            } catch (error) {
                console.error('Error displaying products:', error);
                subtitle.textContent = 'Error displaying products';
                productsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #dc3545;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">⚠️</div>
                        <p>Error displaying products. Please refresh the page.</p>
                    </div>
                `;
            }
        }

        // ============================================
        // PAGE NAVIGATION
        // ============================================

        function showPage(pageName) {
            document.querySelectorAll('.page-container').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageName + 'Page').classList.add('active');
            window.scrollTo(0, 0);
        }

        function scrollToSection(sectionId) {
            showPage('home');
            setTimeout(() => {
                const element = document.getElementById(sectionId);
                if (element) element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // ============================================
        // AUTH FUNCTIONS
        // ============================================

        async function checkAuth() {
            try {
                // Check if there's a hash in the URL (magic link callback)
                const hashParams = new URLSearchParams(window.location.hash.substring(1));
                if (hashParams.get('access_token')) {
                    console.log('Magic link detected, processing authentication...');
                    // Exchange the token
                    const { data, error } = await supabase.auth.getSession();
                    if (error) throw error;
                }

                // Get current session
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {
                    console.log('User authenticated:', session.user.email);
                    currentUser = session.user;
                    updateAuthUI(true);
                    await loadUserProfile();
                    await loadCartFromDB();
                    
                    // Clean up URL after successful auth
                    if (window.location.hash) {
                        window.history.replaceState(null, '', window.location.pathname);
                    }
                } else {
                    console.log('No active session');
                    updateAuthUI(false);
                }
            } catch (error) {
                console.error('Auth error:', error);
                updateAuthUI(false);
            }
        }

        function updateAuthUI(isLoggedIn) {
            const authSection = document.getElementById('authSection');
            const adminNavLink = document.getElementById('adminNavLink');
            
            if (isLoggedIn && currentUser) {
                authSection.innerHTML = `
                    <div class="user-menu">
                        <span class="user-email" onclick="toggleUserMenu()">${currentUser.email}</span>
                        <div class="dropdown-menu" id="userDropdown">
                            <div class="dropdown-item" onclick="showProfilePage()">My Profile</div>
                            <div class="dropdown-item" onclick="handleLogout()">Logout</div>
                        </div>
                    </div>
                `;
                
                // Show admin link if user is admin
                if (ADMIN_EMAILS.includes(currentUser.email)) {
                    adminNavLink.style.display = 'block';
                } else {
                    adminNavLink.style.display = 'none';
                }
            } else {
                authSection.innerHTML = `
                    <button class="auth-btn" onclick="openAuthModal()">Login / Sign Up</button>
                `;
                adminNavLink.style.display = 'none';
            }
        }

        function goToAdminPanel() {
            window.location.href = 'admin.html';
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        async function handleAuth(event) {
            event.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const submitBtn = document.getElementById('authSubmitBtn');
            const infoMsg = document.getElementById('authInfo');
            const errorMsg = document.getElementById('authError');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            errorMsg.style.display = 'none';
            infoMsg.style.display = 'none';

            try {
                const { error } = await supabase.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: window.location.origin
                    }
                });

                if (error) throw error;

                infoMsg.textContent = `Magic link sent to ${email}! Check your inbox.`;
                infoMsg.style.display = 'block';
                document.getElementById('authForm').reset();
                
            } catch (error) {
                errorMsg.textContent = error.message;
                errorMsg.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Magic Link';
            }
        }

        async function handleLogout() {
            await saveCartToDB();
            await supabase.auth.signOut();
            currentUser = null;
            cart = [];
            selectedCartItems.clear();
            updateAuthUI(false);
            updateCartBadge();
            showPage('home');
            showNotification('Logged out successfully');
        }

        function openAuthModal() {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('authInfo').style.display = 'none';
            document.getElementById('authError').style.display = 'none';
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('authForm').reset();
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth state changed:', event);
            
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                updateAuthUI(true);
                closeAuthModal();
                await loadUserProfile();
                await loadCartFromDB();
                showNotification('Welcome back!');
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                updateAuthUI(false);
            }
        });

        // ============================================
        // PROFILE FUNCTIONS
        // ============================================

        async function showProfilePage() {
            showPage('profile');
            await loadUserProfile();
        }

        async function loadUserProfile() {
            if (!currentUser) return;

            document.getElementById('profileEmail').value = currentUser.email;

            const { data, error } = await supabase
                .from('user_profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();

            if (data) {
                document.getElementById('profileName').value = data.full_name || '';
                document.getElementById('profilePhone').value = data.phone || '';
                document.getElementById('profileAddress').value = data.address || '';
                document.getElementById('profileCity').value = data.city || '';
                document.getElementById('profilePostalCode').value = data.postal_code || '';
                document.getElementById('profileState').value = data.state || '';
            }
        }

        async function saveProfile(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('profileSubmitBtn');
            const successMsg = document.getElementById('profileSuccess');
            const errorMsg = document.getElementById('profileError');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            const profileData = {
                id: currentUser.id,
                full_name: document.getElementById('profileName').value,
                phone: document.getElementById('profilePhone').value,
                address: document.getElementById('profileAddress').value,
                city: document.getElementById('profileCity').value,
                postal_code: document.getElementById('profilePostalCode').value,
                state: document.getElementById('profileState').value,
                updated_at: new Date().toISOString()
            };

            try {
                const { error } = await supabase
                    .from('user_profiles')
                    .upsert(profileData);

                if (error) throw error;

                successMsg.textContent = 'Profile saved successfully!';
                successMsg.style.display = 'block';
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
            } catch (error) {
                errorMsg.textContent = error.message;
                errorMsg.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Profile';
            }
        }

        // ============================================
        // CART FUNCTIONS
        // ============================================

        async function addToCart(productName, price, productId = null) {
            const existingItem = cart.find(item => item.name === productName);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ 
                    name: productName, 
                    price: price, 
                    quantity: 1,
                    productId: productId 
                });
            }
            
            updateCartBadge();
            showNotification(`${productName} added to cart!`);
            
            if (currentUser) {
                await saveCartToDB();
            }
        }

        async function saveCartToDB() {
            if (!currentUser) return;

            try {
                await supabase
                    .from('cart_items')
                    .delete()
                    .eq('user_id', currentUser.id);

                if (cart.length > 0) {
                    const cartItems = cart.map(item => ({
                        user_id: currentUser.id,
                        product_name: item.name,
                        product_price: item.price,
                        quantity: item.quantity
                    }));

                    await supabase
                        .from('cart_items')
                        .insert(cartItems);
                }
            } catch (error) {
                console.error('Error saving cart:', error);
            }
        }

        async function loadCartFromDB() {
            if (!currentUser) return;

            try {
                const { data, error } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (data) {
                    cart = data.map(item => ({
                        name: item.product_name,
                        price: parseFloat(item.product_price),
                        quantity: item.quantity
                    }));
                    updateCartBadge();
                }
            } catch (error) {
                console.error('Error loading cart:', error);
            }
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            badge.textContent = totalItems;
            badge.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 100px; right: 30px; background: #28a745; color: white; padding: 1rem 1.5rem; border-radius: 5px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2000);
        }

        function openCart() {
            const modal = document.getElementById('cartModal');
            const cartItemsDiv = document.getElementById('cartItems');
            const totalSection = document.getElementById('cartTotalSection');
            const actionsSection = document.getElementById('cartActions');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
                totalSection.style.display = 'none';
                actionsSection.style.display = 'none';
            } else {
                let itemsHtml = '';
                
                cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    const isSelected = selectedCartItems.has(index);
                    itemsHtml += `
                        <div class="cart-item">
                            <input type="checkbox" class="cart-item-select" 
                                   ${isSelected ? 'checked' : ''} 
                                   onchange="toggleCartItem(${index})">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">RM${item.price.toFixed(2)} x ${item.quantity} = RM${itemTotal.toFixed(2)}</div>
                            </div>
                            <button class="cart-item-remove" onclick="removeFromCart(${index})">Remove</button>
                        </div>
                    `;
                });
                
                cartItemsDiv.innerHTML = itemsHtml;
                updateCartTotal();
                totalSection.style.display = 'block';
                actionsSection.style.display = 'flex';
                checkoutBtn.disabled = selectedCartItems.size === 0;
            }
            
            modal.style.display = 'block';
        }

        function toggleCartItem(index) {
            if (selectedCartItems.has(index)) {
                selectedCartItems.delete(index);
            } else {
                selectedCartItems.add(index);
            }
            updateCartTotal();
            document.getElementById('checkoutBtn').disabled = selectedCartItems.size === 0;
        }

        function updateCartTotal() {
            let total = 0;
            selectedCartItems.forEach(index => {
                const item = cart[index];
                total += item.price * item.quantity;
            });
            document.getElementById('cartTotal').textContent = `RM${total.toFixed(2)}`;
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        async function removeFromCart(index) {
            cart.splice(index, 1);
            selectedCartItems.delete(index);
            
            const newSelected = new Set();
            selectedCartItems.forEach(oldIndex => {
                if (oldIndex > index) {
                    newSelected.add(oldIndex - 1);
                } else if (oldIndex < index) {
                    newSelected.add(oldIndex);
                }
            });
            selectedCartItems = newSelected;
            
            updateCartBadge();
            openCart();
            
            if (currentUser) {
                await saveCartToDB();
            }
        }

        async function clearCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                cart = [];
                selectedCartItems.clear();
                updateCartBadge();
                openCart();
                
                if (currentUser) {
                    await saveCartToDB();
                }
            }
        }

        // ============================================
        // CHECKOUT FUNCTIONS
        // ============================================

        async function proceedToCheckout() {
            if (selectedCartItems.size === 0) {
                alert('Please select items to checkout by checking the boxes next to each item');
                return;
            }

            checkoutItems = [];
            selectedCartItems.forEach(index => {
                checkoutItems.push(cart[index]);
            });

            closeCart();
            await loadCheckoutPage();
            showPage('checkout');
        }

        async function loadCheckoutPage() {
            // Display checkout items
            const checkoutItemsDiv = document.getElementById('checkoutItems');
            let itemsHtml = '';
            let total = 0;

            checkoutItems.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                itemsHtml += `
                    <div class="order-item">
                        <div>
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-details">Quantity: ${item.quantity}</div>
                        </div>
                        <div class="order-item-price">RM${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            });

            checkoutItemsDiv.innerHTML = itemsHtml;
            document.getElementById('checkoutSubtotal').textContent = `RM${total.toFixed(2)}`;
            document.getElementById('checkoutTotalAmount').textContent = `RM${total.toFixed(2)}`;

            // Auto-fill form with user data
            if (currentUser) {
                document.getElementById('checkoutEmail').value = currentUser.email;

                const { data } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (data) {
                    document.getElementById('checkoutName').value = data.full_name || '';
                    document.getElementById('checkoutPhone').value = data.phone || '';
                    document.getElementById('checkoutAddress').value = data.address || '';
                    document.getElementById('checkoutCity').value = data.city || '';
                    document.getElementById('checkoutPostalCode').value = data.postal_code || '';
                    document.getElementById('checkoutState').value = data.state || '';
                }
            }
        }

        async function submitCheckout(event) {
            event.preventDefault();

            const submitBtn = document.getElementById('checkoutSubmitBtn');
            const successMsg = document.getElementById('checkoutSuccess');
            const errorMsg = document.getElementById('checkoutError');

            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing Order...';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            const totalAmount = checkoutItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const orderData = {
                type: 'Checkout',
                timestamp: new Date().toLocaleString('en-MY', { timeZone: 'Asia/Kuala_Lumpur' }),
                items: checkoutItems.map(item => `${item.name} (Qty: ${item.quantity})`).join(', '),
                name: document.getElementById('checkoutName').value,
                email: document.getElementById('checkoutEmail').value,
                phone: document.getElementById('checkoutPhone').value,
                address: document.getElementById('checkoutAddress').value,
                city: document.getElementById('checkoutCity').value,
                postalCode: document.getElementById('checkoutPostalCode').value,
                state: document.getElementById('checkoutState').value,
                notes: document.getElementById('checkoutNotes').value,
                total: `RM${totalAmount.toFixed(2)}`,
                userEmail: currentUser ? currentUser.email : 'Guest'
            };

            console.log('Checkout order submitted:', orderData);

            // Send to Google Sheets
            await sendToGoogleSheets(orderData);

            setTimeout(async () => {
                successMsg.textContent = 'Order placed successfully! We will contact you soon.';
                successMsg.style.display = 'block';

                // Remove checked out items from cart
                const remainingCart = [];
                cart.forEach((item, index) => {
                    if (!selectedCartItems.has(index)) {
                        remainingCart.push(item);
                    }
                });
                cart = remainingCart;
                selectedCartItems.clear();
                checkoutItems = [];
                
                updateCartBadge();
                if (currentUser) {
                    await saveCartToDB();
                }

                submitBtn.disabled = false;
                submitBtn.textContent = 'Place Order';

                setTimeout(() => {
                    showPage('home');
                    showNotification('Thank you for your order!');
                }, 3000);
            }, 1500);
        }

        // ============================================
        // DIRECT ORDER FUNCTIONS
        // ============================================

        async function openOrderForm(productName, price, productId = null) {
            document.getElementById('product').value = productName;
            document.getElementById('price').value = price;
            document.getElementById('orderModal').style.display = 'block';
            document.getElementById('orderSuccess').style.display = 'none';
            
            // Load product details to show available sizes and colors
            if (productId) {
                const product = allProducts.find(p => p.id === productId);
                if (product && product.sizes) {
                    const sizeSelect = document.getElementById('orderSize');
                    sizeSelect.innerHTML = '<option value="">Select Size</option>' + 
                        product.sizes.map(size => `<option value="${size}">${size}</option>`).join('');
                }
            }
            
            if (currentUser) {
                document.getElementById('orderEmail').value = currentUser.email;
                
                const { data } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (data) {
                    document.getElementById('orderName').value = data.full_name || '';
                    document.getElementById('orderPhone').value = data.phone || '';
                    document.getElementById('orderAddress').value = data.address || '';
                    document.getElementById('orderCity').value = data.city || '';
                    document.getElementById('orderPostalCode').value = data.postal_code || '';
                    document.getElementById('orderState').value = data.state || '';
                }
            }
        }

        function closeOrderForm() {
            document.getElementById('orderModal').style.display = 'none';
            document.getElementById('orderForm').reset();
        }

        async function submitOrder(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('orderSubmitBtn');
            const successMsg = document.getElementById('orderSuccess');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            
            const orderData = {
                type: 'Direct Order',
                timestamp: new Date().toLocaleString('en-MY', { timeZone: 'Asia/Kuala_Lumpur' }),
                items: document.getElementById('product').value,
                name: document.getElementById('orderName').value,
                email: document.getElementById('orderEmail').value,
                phone: document.getElementById('orderPhone').value,
                address: document.getElementById('orderAddress').value,
                city: document.getElementById('orderCity').value,
                postalCode: document.getElementById('orderPostalCode').value,
                state: document.getElementById('orderState').value,
                quantity: document.getElementById('orderQuantity').value,
                size: document.getElementById('orderSize').value,
                customDesign: document.getElementById('orderCustomDesign').value,
                notes: document.getElementById('orderNotes').value,
                total: document.getElementById('price').value,
                userEmail: currentUser ? currentUser.email : 'Guest'
            };

            console.log('Direct order submitted:', orderData);
            
            // Send to Google Sheets
            await sendToGoogleSheets(orderData);
            
            setTimeout(() => {
                successMsg.style.display = 'block';
                document.getElementById('orderForm').reset();
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Order';
                
                setTimeout(() => closeOrderForm(), 3000);
            }, 1000);
        }

        // ============================================
        // FAQ TOGGLE
        // ============================================

        function toggleFaq(element) {
            element.classList.toggle('active');
            element.nextElementSibling.classList.toggle('active');
        }

        // ============================================
        // MODAL CLOSE ON OUTSIDE CLICK
        // ============================================

        window.onclick = function(event) {
            const orderModal = document.getElementById('orderModal');
            const cartModal = document.getElementById('cartModal');
            const authModal = document.getElementById('authModal');
            
            if (event.target === orderModal) closeOrderForm();
            if (event.target === cartModal) closeCart();
            if (event.target === authModal) closeAuthModal();
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        console.log('Initializing Benzgifts website...');

        // Load products immediately on page load
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM loaded, starting initialization...');
            try {
                console.log('Step 1: Checking authentication...');
                await checkAuth();
                console.log('Step 2: Authentication check complete');
            } catch (error) {
                console.error('Error in checkAuth:', error);
            }
            
            try {
                console.log('Step 3: Loading products from database...');
                await loadProducts();
                console.log('Step 4: Products loaded successfully!');
            } catch (error) {
                console.error('Error in loadProducts:', error);
            }
            
            console.log('Initialization complete!');
        });

        // Also try to load after a delay as backup
        setTimeout(async () => {
            console.log('Backup timer: Attempting to load products...');
            try {
                await loadProducts();
            } catch (error) {
                console.error('Backup load error:', error);
            }
        }, 2000);
        
        updateCartBadge();

        // Save cart before page unload
        window.addEventListener('beforeunload', async () => {
            if (currentUser) {
                await saveCartToDB();
            }
        });

        // Make loadProducts accessible globally for the refresh button
        window.refreshProducts = async function() {
            console.log('Manual refresh triggered...');
            try {
                await loadProducts();
            } catch (error) {
                console.error('Manual refresh error:', error);
                alert('Error loading products: ' + error.message);
            }
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            const dropdown = document.getElementById('userDropdown');
            
            if (userMenu && dropdown && !userMenu.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        console.log('Benzgifts website loaded successfully!');
    </script>
</body>
</html>
